
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Protect the events collection
    match /events/{eventId} {
      // Allow a user to read, create, update, or delete an event if they are the owner
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;

      // Protect the expenses subcollection
      match /expenses/{expenseId} {
        // Allow a user to read, create, update, or delete an expense
        // if they own the parent event document.
        allow read, write: if request.auth != null && get(/databases/$(database)/documents/events/$(eventId)).data.userId == request.auth.uid;
      }
    }
  }
}
